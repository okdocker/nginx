sudo: required

language: c

env:
  global:
    - secure: "Q/J6QsXmQEt87tswQEYxRBz233r3wVav3AWMsz4HeWqBjb3UxJhJn7XUZhf0yuddtBhv/8WbCrbKqby7eeTx7rfLsSJhkvbffStj7vuxwWERgqMYYYG3W+UX93le8k9OizXLA61Kjx6asFVf90sGazj1O3a0PFzsfFElt14VW66BlMCOrPf8leVHLlR9CpfQTmxE0uUJpzy5ZDBvGzpaEyw9J7cFwa57370woBDytn+1oQZYN1D9r7ZfTz0otwd4eGug9jTwnUpbXOqUimg/XZBSM4279otpFNNalG35osvuVUMcbnx7PK3i9trbweStCiJ6Oxs2qr9x3iwdAwTsr1etQPjofuzPLZ4oi800kR/Aq8OSt12nb14YPDqvrQdRTQZk6ZvM41VdQykJq/1vd6N61asb5WZTfAv5TdJeoscHz5ruOJ4EXAhP1T2/bZZrqxBPiKIUnxR7OGViZRYJcAHFzwE0hcrrGg4PwR9qK0PUcjFBg/4rWsaPzUKW3XdSnTv5ra3QAZQks01Dvo3VXjcwkYTYppWbuPnQmciwm6Z8ejncJNLpd1OZk0VeRn+9y/qiO0a0pvazJaOb3j6IumBudjW9IajZaLL/XLmbPyj+YrtjtI6OzDpWpGkYUczb7J94XEMh2zXDH45va6Yv6RN3P6f1GsHP6bJAyZyqSKU="
    - secure: "i21YQzrgh9L6yMhF4Xfcy00czze+sG7fwGbecdbzFeu6msqqyqZ6wS0sMS//H1SrAvqCQYQCXbYqDcVESKF9LXD0ixPHKuEIe5qy/TXIOrWfBgbi2uEj5pYDBG4cYznCDrYBfKDGris7L4F5L+a1g8aUlkUN5iqy+dKI/Pa+sItd/T9SoQ3V/+MUQuci/qFV66wYVd+hDV0UxaweeNwdXVq3NhwXa+LC/BlPNpWLv/pB2t3xDjphvaweEebIzi7/w2R+LehABhlWEGqeq5iHE0S8alCjv3bQUCcqr/4y0qL3ngQ31JIVrU6ZDCR39k9txQaXu2TsyC/pIxkxKuqYwGSPDUK8+ylyLs9fNDzyXu94iPWH3u/abLUtHTM02ZiCJoklKvQv7QFwF4HOgJShD9Tr9J5w5xWLeybdnZ4CuCNvtwTlp5DR7A/fbIpOVf27iKpVzHW1FXv6JhlwcG0FR2QrSSlKFSimAbKer7+AcxIXKbGUdBHAWtXJILDE2OhsqyOrg3Sgy+I7fMh9F9PPvCNpqvdV6UrEDYEyYTDP5gcwN6ttEykaMck6RtIKVNWywBzHiRM1IK8OZx3NwR86Z5XJT+0Lzl+FiwVJq7D8/XI+XlhE+fRD6H+0QV8mmgAwaDc6j+1r3zmO4sWVbJb807/qt+P2j9LM81h/wEjoJaU="
    - secure: "KoHz87X00WrT7UlVizA/BBuK4niVvH9nex0/73n/A2cEgGzs+SVrIKjkWrTioxpqRUcjUkBknOBBqyyhgzxrnQg82JDf2UoP9TLd7EK2f4bROAyQbLyG91puBw4drDgtRJIupmrwuANRtVZqkkazyfgTBEQgxH99Ipe0HeDlLiCmwzaTZmsEWqyR2XpjQXrXn2364DajbJAp1Od5fne8HG+6ZagmB6kQrdYN2LYurV5XGwSYxg1ZbPwhVA2RyyhptvTPIk4SewgZ2Cyg0e19gVyixlQxLq1aD8jbTeXZ1gSdM1bWum02xWaW9EykIrnKdSlsd2w4F1ZIwo0WdN2er6vBHt95Eq+yRxm9xrVckVh/SrWJy27Gnl0+0i5A90Sse56qS9Mm1ts6/hCYUqClDhYsyj4c1UNUP9Oyv+5fbAzilE2T5vM3G8ZVeOc3+lrH1jscA+/SVgtc6YmX67S2S1A/JAux3GJzlZvEMaSPl/PMIxyC27tKQPjJx+aiAmsCUqDMqh6DI7kZregDftAMteyOC+X92oqqPi6kLLa8RMg4YlzxiC7xJMo2BZIZ++FkkxF5c5n4R2sLSnUrY5DDj2W5k771LkYJgbUnDG6/ghT1WpF8xfdro6vSTIs4Z+ONksuzGXj5MVTUj6sQ/bMdHlox5BXzxNVM0aoJNe8Bxxg="
    - secure: "ZmK/v+vzzig5pk0432WRR2QsvzsPPiHF5Sge8UlO4vzw4cMPd3Xq08b7vnIreOwMlB4FCsEnuHKqdseU3LGYNpar8TYjNN2A7l/j1U2bG/x6TFzCqQTo98XfgRlQ9KYyxQj3YfkYFeYwM8tqq/KbYDypoEZf3SDEGrrcFoDOVQGb0zTlIpPftCDH1J5d4FD6fpB6hgytoAHXRWt3aipMxiDEpK5Klnxku/vIDTvE0E+SLpYocVaj7AhuCsy5jDJp6OM6lOKTSl/YwSyfjDibs4TSs5jT54rfMBRMG6/RQ95r3oyPrjqLQn+UNEEG3vyvMKgGsYbspUH3EV53HdVfCMvWSmrS3yYz/ygiog81HSerQr+t8UQVah0NEnS1Za967/fCldhPfo2Yp9cc4X4PKFg2JSPKp0R0Ac2hDliJEWiv96JfecYx9b2zYTxPLLL1OepUhcEFLIWxfLU4nXZckx4aPvDtwjC9URta7ABv/5sg+0vah6Kof6ZEd2poeKbF1C2BnGNSiR9kCagaBgjD9OmD+bWgrSeFxf3XPO6BZVMy1mrUnJKaLX0RZgbUIhQN/3VoBtBsN0jmPkTx/nZCwzTF/Ytz91ud1sBjlQODMBV0W5MmM+nbOk4EXRQDTZoRJuksBZVaO/CaGT8+A2Xs0ymcZmsZ+QJF2+Ge71mTEgQ="
    - COMMIT=${TRAVIS_COMMIT::8}
    - export REPO=okdocker/nginx
    - PAGESPEED_VERSION=1.13.35.2
    - PSOL_VERSION=1.13.35.2
  matrix:
    - NGINX_VERSION=1.13.9 VARIANT=mainline
    - NGINX_VERSION=1.12.2 VARIANT=stable

install:
  - curl -O -L https://github.com/grammarly/rocker/releases/download/1.3.1/rocker-1.3.1-linux_amd64.tar.gz
  - tar xvfz rocker-1.3.1-linux_amd64.tar.gz

script:
  - ./rocker build --auth $DOCKER_USER:$DOCKER_PASS --push -var TravisBuildNumber=$TRAVIS_BUILD_NUMBER -var Commit=$COMMIT -var DockerImage=$REPO:$NGINX_VERSION -var NginxVersion=$NGINX_VERSION -var NginxVariant=$VARIANT -var PagespeedVersion=$PAGESPEED_VERSION -var PsolVersion=$PSOL_VERSION
  - ./rocker build --auth $DOCKER_USER:$DOCKER_PASS --push -var TravisBuildNumber=$TRAVIS_BUILD_NUMBER -var Commit=$COMMIT -var DockerImage=$REPO:$VARIANT -var NginxVersion=$NGINX_VERSION -var NginxVariant=$VARIANT -var PagespeedVersion=$PAGESPEED_VERSION -var PsolVersion=$PSOL_VERSION
  - ./rocker build --auth $QUAY_USER:$QUAY_PASS --push -var TravisBuildNumber=$TRAVIS_BUILD_NUMBER -var Commit=$COMMIT -var DockerImage=quay.io/$REPO:$NGINX_VERSION -var NginxVersion=$NGINX_VERSION -var NginxVariant=$VARIANT -var PagespeedVersion=$PAGESPEED_VERSION -var PsolVersion=$PSOL_VERSION
  - ./rocker build --auth $QUAY_USER:$QUAY_PASS --push -var TravisBuildNumber=$TRAVIS_BUILD_NUMBER -var Commit=$COMMIT -var DockerImage=quay.io/$REPO:$VARIANT -var NginxVersion=$NGINX_VERSION -var NginxVariant=$VARIANT -var PagespeedVersion=$PAGESPEED_VERSION -var PsolVersion=$PSOL_VERSION

